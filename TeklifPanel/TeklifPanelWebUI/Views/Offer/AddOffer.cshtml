@model List<Customer>

<div class="container-fluid">
    <div class="card px-0 pb-0 mb-3">
        <form id="msform">
            <!-- progressbar -->
            <ul id="progressbar">
                <li class="active" id="account"><strong>Müşteri Seç</strong></li>
                <li id="personal"><strong>Ürünleri Seç</strong></li>
                <li id="payment"><strong>Ön İzleme</strong></li>
                <li id="confirm"><strong>Gönderildi</strong></li>
            </ul>
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuemin="0"
                     aria-valuemax="100"></div>
            </div>
            <!-- fieldsets -->

            <fieldset>
                <div class="form-card">

                    <div class="row">
                        <div class="col-7">
                            <h2 class="fs-title">Müşteriler:</h2>
                        </div>
                        <div class="col-5">
                            <h2 class="steps">Adım 1 - 4</h2>
                        </div>
                    </div>
                    <label for="customerId" class="fieldlabels">Müşteri Seçin:</label>
                    <select id="customerId" onchange="getContactPersonList()">
                        <option>Seçiniz</option>
                        @foreach (var customer in Model)
                        {
                            <option value="@customer.Id">@customer.Name</option>
                        }
                    </select>
                    <div id="contactPersonList">
                        <label for="contactPersons" class="fieldlabels">Yetkiliyi Seçin:</label>
                        <select id="contactPersons">
                            <option>Seçiniz</option>
                            @* PartialView ContackPerson *@
                        </select>
                    </div>
                </div>

                <input type="button" name="next" class="next action-button" value="İLERİ" />

            </fieldset>

            <fieldset>
                <div class="form-card">

                    <div class="row">
                        <div class="col-4">
                            <h2 class="fs-title">Ürünler:</h2>
                        </div>
                        <div class="col-4">
                        </div>
                        <div class="col-4">
                            <h2 class="steps">Adım 2 - 4</h2>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8">
                            <label for="categoryId" class="fieldlabels">Kategori Seçin:</label>
                            <select id="categoryId" onchange="getCategories()">
                                <option>Seçiniz</option>
                                @foreach (var category in (List<Category>)ViewBag.Categories)
                                {
                                    <option value="@category.Id">@category.Name</option>
                                }
                            </select>
                            <table class="table-fill">
                                <thead>
                                    <tr>
                                        <th class="text-center">Kategori</th>
                                        <th class="text-center">Ürün Adı</th>
                                        <th class="text-center">Kod</th>
                                        <th class="text-center">Fiyat</th>
                                        <th class="text-center">Fotoğraf</th>
                                        <th class="text-center">Stok</th>
                                        <th class="text-center">İskonto</th>
                                        <th class="text-center">Ekle</th>
                                    </tr>
                                </thead>
                                <tbody class="table-hover" id="productList">
                                    @* PartialView - GetProducts *@
                                </tbody>
                            </table>
                        </div>
                        <div class="col-4">
                            <div id="selectedProducts">

                            </div>
                        </div>
                    </div>
                </div>

                <input type="button" id="nextButton" name="next" class="next action-button" value="İLERİ" />
                <input type="button" name="previous" class="previous action-button-previous" value="GERİ" />

            </fieldset>

            <fieldset>
                <div class="form-card">

                    <div class="row">
                        <div class="col-7">
                            <h2 class="fs-title">Ön İzleme:</h2>
                        </div>
                        <div class="col-5">
                            <h2 class="steps">Adım 3 - 4</h2>
                        </div>
                    </div>

                    <div class="container mt-5">
                        <div class="d-flex" style="justify-content: space-between;">
                            <div class="span4">
                                <img src="Content/images/logo/logo.png" class="mb-4">
                                <address>
                                    <strong>Defne Banyo</strong><br>
                                    <p class="mt-4">
                                        Esenkent, Muhterem Sk No:56, 34776<br> Dudullu Osb/Ümraniye/İstanbul, Türkiye
                                    </p>
                                </address>
                            </div>
                            <div class="span4 well">
                                <div class="fatura-baslik">
                                    ÖNİZLEME
                                </div>
                                <div class="fatura-no mt-4">
                                    <strong>Teklif No:</strong> 2202
                                </div>
                                <div class="tarih mt-4">
                                    <strong>Teklif Tarih:</strong>@DateTime.Now.ToShortDateString()
                                </div>
                            </div>
                        </div>

                        <hr class="my-4">

                        <div class="musteri-bilgi">
                            <h5 class="musterifir">
                                Örnek Firma
                            </h5>
                            <Strong>Sayın</Strong>
                            <p>Ebru Yılmaz</p>
                            <p class="adres">
                                Lorem ipsum dolor sit amet consectetur adipisicing elit. Voluptatem quia magni aliquid unde
                                nostrum minus.
                            </p>
                            <div class="v-daire">
                                <strong>Vergi Dairesi</strong><br>
                                Gebze
                            </div>
                        </div>
                        <div class="row">
                            <div class="span8">
                                <hr>
                            </div>
                        </div>

                        <div class="row">
                            <div class="span8 well invoice-body">

                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Ürün Adı</th>
                                            <th>Ürün Kodu</th>
                                            <th>Ürün Adeti</th>
                                            <th>KDV</th>
                                            <th>Ürün Fiyatı</th>
                                            <th>İskonto</th>
                                            <th>İskontolu Fiyatı</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td style="font-weight: bold;">Demir Çelik</td>
                                            <td>56421</td>
                                            <td>3</td>
                                            <td>%20</td>
                                            <td>500₺</td>
                                            <td>%10</td>
                                            <td>400₺</td>
                                        </tr>

                                        <tr>
                                            <td colspan="5">&nbsp;</td>
                                            <td><strong>Toplam Fiyat</strong></td>
                                            <td><strong>7,500.00₺</strong></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5">&nbsp;</td>
                                            <td><strong>İskontolu Fiyat</strong></td>
                                            <td><strong>6,750.00₺</strong></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5">&nbsp;</td>
                                            <td><strong>Toplam KDV</strong></td>
                                            <td><strong>1,350.00₺</strong></td>
                                        </tr>
                                        <tr>
                                            <td colspan="5">&nbsp;</td>
                                            <td><strong>Genel Toplam</strong></td>
                                            <td><strong>8,100.00₺</strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="fatura-not">
                            Lorem ipsum, dolor sit amet consectetur adipisicing elit. Quos saepe nobis libero harum nesciunt
                            commodi.
                        </div>
                    </div>

                </div>

                <input type="button" name="next" class="next action-button" value="GÖNDER" />
                <input type="button" name="previous" class="previous action-button-previous" value="GERİ" />

            </fieldset>

            <fieldset>
                <div class="form-card">

                    <div class="row">
                        <div class="col-7">
                            <h2 class="fs-title">Tamamlandı:</h2>
                        </div>
                        <div class="col-5">
                            <h2 class="steps">Adım 4 - 4</h2>
                        </div>
                    </div> <br><br>

                    <h2 class="purple-text text-center"><strong>GÖNDERİLDİ!</strong></h2> <br>
                    <div class="row justify-content-center">
                        <div class="text-center">
                            <i class="fas fa-check"></i>
                        </div>
                    </div> <br><br>
                    <div class="row justify-content-center">
                        <div class="col-7 text-center">
                            <h5 class="purple-text text-center">TEKLİFİNİZ BAŞARIYLA İLETİLDİ!</h5>
                        </div>
                    </div>
                </div>

            </fieldset>

        </form>
    </div>
</div>


@*Müşterilerin İletişim kişilerini getirme*@
<script>

    function getContactPersonList() {
        let customerId = $("#customerId").val();
        $.ajax({
            type: "GET",
            url: "/Offer/ContactPersons?id=" + customerId,
            success: function (data) {
                $("#contactPersonList").html(data);
            }
        });
    }
</script>

@*Seçilen kategoriye göre gelecek ürünler*@
<script>
    function getCategories() {
        let categoryId = $("#categoryId").val();
        let selectedCustomerId = $('#customerId').val();

        $.ajax({
            type: "GET",
            url: "/Offer/GetProducts?id=" + categoryId,
            data: {
                customerId: selectedCustomerId,
            },
            success: function (result) {
                $("#productList").html(result);
                let list = $('.temp');
                for (let i = 0; i < list.length; i++) {
                    let id = list[i].value;
                    if (document.getElementById('selectedDiv' + id) != undefined) {
                        $("#seletedItem" + id)[0].checked = true;
                    }
                }
            }
        });
    }
</script>

@*Ürün seçme*@
<script>
    function isSelected(id) {
        let checkBox = document.getElementById('seletedItem' + id);
        if (checkBox.checked) {
            let categoryName = $('.seletedItem' + id)[0].innerText;
            let productName = $('.seletedItem' + id)[1].innerText;
            let productDiscount = $('.seletedItem' + id)[2].innerText;
            var productHtml = `
                    <div class=" mb-4" id="selectedDiv${id}">
                    <input type="hidden" id="id" value="${id} name="Id" />
                        <div class="form-row row">
                            <div class="form-group col-lg-5 col-md-5 col-12">
                                <label >Ürün Kategori</label>
                                <label class="selectedDivItem${id}">${categoryName}</label>
                            </div>
                            <div class="form-group col-lg-5 col-md-5 col-12">
                                <label >Ürün Adı</label>
                                <label class="selectedDivItem${id}">${productName}</label>
                            </div>
                        </div>
                        <div class="form-row row">
                            <div class="form-group col-lg-5 col-md-5 col-12">
                                <label for="inputName">Adet</label>
                                <input type="number" id="Amount" class="form-control" name="Amount" placeholder="Adet" >
                            </div>
                            <div class="form-group col-lg-5 col-md-5 col-12">
                                <label>İskonto</label>
                                <input type="text" id="Discount" class="form-control" name="Discount" placeholder="İskonto" value="${productDiscount}" >
                            </div>
                            <div class="form-group col-lg-1 col-md-1 col-12">
                                <button class=" btn btn-danger  remove-contact" onclick="removeDiv(${id})" >Sil</button>
                            </div>
                        </div>
                    <hr />
                    </div>
                    `;
            document.getElementById('selectedProducts').innerHTML += productHtml;
        }
        else {
            document.getElementById('selectedDiv' + id).remove();
        }
    }
      
    $('#nextBuuton').on('click', function () {
        let idValue = document.getElementById('id').value;
        let amountValue = document.getElementById('Amount').value;
        let discountValue = document.getElementById('Discount').value;
        let data = {
            id = idValue,
            amunt = amountValue,
            discount = discountValue
        };


    })

</script>

@*Seçilen ürünü kaldırma*@
<script>
    function removeDiv(id) {
        alert(id)
        document.getElementById('selectedDiv' + id).remove();
        document.getElementById('seletedItem' + id).checked = false;
    }
</script>

<script>
    $(document).ready(function () {
        $('#nextButton').on('click', function () {

            $.ajax({
                type: 'POST',
                url: '/Offer/OfferPreview',
                data: postData
            });
        });
    });
</script>


@*İleri ve Geri Butonlarının aktivasyonu*@
<script>
    $(document).ready(function () {

        var current_fs, next_fs, previous_fs; //fieldsets
        var opacity;
        var current = 1;
        var steps = $("fieldset").length;

        setProgressBar(current);

        $(".next").click(function () {

            current_fs = $(this).parent();
            next_fs = $(this).parent().next();

            //Add Class Active
            $("#progressbar li").eq($("fieldset").index(next_fs)).addClass("active");

            //show the next fieldset
            next_fs.show();
            //hide the current fieldset with style
            current_fs.animate({ opacity: 0 }, {
                step: function (now) {
                    // for making fielset appear animation
                    opacity = 1 - now;

                    current_fs.css({
                        'display': 'none',
                        'position': 'relative'
                    });
                    next_fs.css({ 'opacity': opacity });
                },
                duration: 500
            });
            setProgressBar(++current);
        });

        $(".previous").click(function () {

            current_fs = $(this).parent();
            previous_fs = $(this).parent().prev();

            //Remove class active
            $("#progressbar li").eq($("fieldset").index(current_fs)).removeClass("active");

            //show the previous fieldset
            previous_fs.show();

            //hide the current fieldset with style
            current_fs.animate({ opacity: 0 }, {
                step: function (now) {
                    // for making fielset appear animation
                    opacity = 1 - now;

                    current_fs.css({
                        'display': 'none',
                        'position': 'relative'
                    });
                    previous_fs.css({ 'opacity': opacity });
                },
                duration: 500
            });
            setProgressBar(--current);
        });

        function setProgressBar(curStep) {
            var percent = parseFloat(100 / steps) * curStep;
            percent = percent.toFixed();
            $(".progress-bar")
                .css("width", percent + "%")
        }

        $(".submit").click(function () {
            return false;
        })

    });
</script>